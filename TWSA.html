<html lang="en"><head>
    <meta charset="UTF-8">
    <base href="/">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Two-Way South Africa</title><style>
    :root {
      --primary: #007A3D;     /* SA green */
      --secondary: #00542d;   /* Darker SA green */
      --accent: #FDB913;      /* SA gold */
      --background: #f0f5f2;  /* Subtle */
      --text: #333333;        /* Dark gray */
      --shadow: rgba(0,0,0,0.1);  /* Shadow */
      --error: #d32f2f;       /* Bright red */
      --error-bg: #ffebee;    /* Light red */
      --warning: #f9a825;     /* Orange */
      --warning-bg: #fff3e0;  /* Light orange */
      --info: #006838;        /* Deep green */
      --info-bg: #f0f5f2;     /* Soft green */
      --white: #ffffff;       /* White */
      --grey-light: #f5f5f5; /* Very light gray */
      --grey: #e0e0e0;       /* Light gray */
      --grey-dark: #9e9e9e;  /* Gray */
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', system-ui, sans-serif;
    }
    
    @keyframes softPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.02); }
      100% { transform: scale(1); }
    }
    
    @keyframes floatAnimation {
      0% { transform: translateY(0px); }
      50% { transform: translateY(-5px); }
      100% { transform: translateY(0px); }
    }
    
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    
    @keyframes subtleFade {
      0% { opacity: 0.8; }
      50% { opacity: 1; }
      100% { opacity: 0.8; }
    }
    
    body {
      background: var(--background);
      color: var(--text);
      font-size: 18px;
      line-height: 1.6;
      position: relative;
    }
    
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background: var(--background);
      z-index: -1;
    }
    
    .header-logo-container {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 2rem;
      padding: 1rem;
      background: rgba(255,255,255,0.9);
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      text-align: center;
      width: 100%;
    }
    
    .header-logo-container h1 {
      margin: 0;
      color: var(--primary);
      font-size: 2.4rem;
      font-weight: 700;
      letter-spacing: -0.5px;
    }
    
    .splash-screen {
      position: fixed;
      inset: 0;
      background: var(--primary);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    
    .splash-screen.hidden {
      display: none;
    }
    
    .logo-text {
      color: white;
      font-size: 3.5rem !important;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
      margin-bottom: 3rem !important;
      text-align: center;
      font-weight: 700;
      letter-spacing: -0.5px;
    }
    
    .proceed-btn, .btn {
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      font-weight: 600;
    }
    
    .proceed-btn {
      padding: 1.2rem 3rem;
      font-size: 1.2rem;
      letter-spacing: 1px;
    }
    
    .proceed-btn:hover {
      background: var(--secondary);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .btn {
      padding: 1rem 1.5rem;
      font-size: 1.1rem;
      width: 100%;
      margin-top: auto;
      margin-bottom: 0;
      letter-spacing: 0.5px;
    }
    
    .btn:hover {
      transform: scale(1.05);
      background: var(--accent);
    }
    
    .dashboard {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 0 1rem;
      position: relative;
      overflow: hidden;
    }
    
    .dashboard::after {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, var(--background) 0%, transparent 70%);
      opacity: 0.5;
      animation: subtleFade 10s infinite;
      pointer-events: none;
      z-index: -1;
    }
    
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 2rem;
      margin-top: 2rem;
    }
    
    .card {
      background: white;
      padding: 2rem;
      border-radius: 16px;
      box-shadow: 0 6px 12px var(--shadow);
      transition: transform 0.3s ease;
      cursor: pointer;
      border-left: 6px solid var(--primary);
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      min-height: 250px;
    }
    
    .card:hover {
      transform: translateY(-5px);
    }
    
    .card h2 {
      color: var(--primary);
      margin-bottom: 1rem;
      font-size: 1.8rem;
      font-weight: 700;
      letter-spacing: -0.5px;
    }
    
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.2);
      -webkit-backdrop-filter: blur(4px); /* Added for Safari support */
      backdrop-filter: blur(4px);
      z-index: 999;
    }
    
    .form-group {
      margin-bottom: 1.75rem;
      position: relative;
    }
    
    .form-group:last-of-type {
      margin-bottom: 2rem;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 0.75rem;
      font-weight: 600;
      color: var(--secondary);
    }
    
    .form-control {
      width: 100%;
      padding: 1rem;
      border: 2px solid var(--secondary);
      border-radius: 8px;
      font-size: 1.1rem;
      transition: all 0.3s ease;
      background: var(--background);
      color: var(--text);
    }
    
    .form-control:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(46, 125, 50, 0.2);
    }
    
    .form-control.error {
      border-color: var(--error);
    }
    
    .error-message {
      color: var(--error);
      font-size: 0.9rem;
      margin-top: 0.25rem;
      padding: 0.5rem;
      background: var(--error-bg);
      border-radius: 4px;
    }
    
    .tip-message {
      color: var(--info);
      font-size: 0.9rem;
      margin-top: 0.25rem;
      padding: 0.5rem;
      background: var(--info-bg);
      border-radius: 4px;
    }
    
    .tooltip {
      position: relative;
      display: inline-block;
    }
    
    [data-translate] {
      transition: opacity 0.3s ease;
    }
    
    .translating {
      opacity: 0;
    }
    
    .tooltip:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      padding: 0.5rem;
      background: var(--text);
      color: white;
      border-radius: 4px;
      font-size: 0.9rem;
      white-space: nowrap;
      z-index: 1;
    }
    
    .chat-button {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 60px;
      height: 60px;
      background: var(--primary);
      border: none;
      border-radius: 50%;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      cursor: pointer;
      z-index: 999;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.3s ease;
    }
    
    .chat-button:hover {
      transform: scale(1.1);
    }
    
    .chat-button svg {
      width: 30px;
      height: 30px;
      fill: white;
    }
    
    @media (max-width: 768px) {
      .grid {
        grid-template-columns: 1fr;
      }
    }  
      body {
        font-size: 16px;
    }
    
    </style>
    </head>
    <body>
    
    <div class="splash-screen">
      <div class="logo-container" style="text-align: center;">
        <h1 class="logo-text">Two-Way South Africa</h1>
        <button class="proceed-btn" onclick="hideSplashScreen()">Proceed to Dashboard</button>
      </div>
    </div>
    
    <main class="dashboard">
      <div class="header-logo-container">
      <h1 id="welcomeText">Welcome to Two-Way South Africa</h1>
    </div>
      
      <div class="grid">
        <div class="card" data-tooltip="Report issues or request local services">
          <h2>Report Issues/Request Services</h2>
          <p>Submit your municipal service requests</p>
          <button class="btn" onclick="showReportForm()">Get Started</button>
        </div>
        
        <div class="card" data-tooltip="Stay updated with local events">
          <h2>Local Events & News</h2>
          <p>Check what's happening in your community</p>
          <button class="btn" onclick="showEvents()">View Events</button>
        </div>
        
        <div class="card" data-tooltip="Check the status of your requests">
          <h2>Track Service Requests</h2>
          <p>Monitor the progress of your submissions</p>
          <button class="btn" onclick="showTracker()">Track Now</button>
        </div>
      </div>
    </main>

    <button class="chat-button" type="button" onclick="openChat()" aria-label="Open chat">
        <svg viewBox="0 0 24 24">
          <path d="M20,2H4C2.9,2,2,2.9,2,4v18l4-4h14c1.1,0,2-0.9,2-2V4C22,2.9,21.1,2,20,2z M19,13H5v-2h14V13z M19,9H5V7h14V9z"/>
        </svg>
    </button>
    
    <script>

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    
/* CHAT */
    
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    

    let chatHistory = [];
    const keywords = {
      pothole: {
        questions: [
          "Could you tell me where exactly this pothole is located?",
          "Is it a large pothole that's causing traffic to swerve?",
          "How long has this pothole been there?",
          "Are there any landmarks nearby that could help us locate it?"
        ],
        tip: "While we address this, try to avoid the pothole by safely moving around it. If possible, alert other drivers."
      },
      water: {
        questions: [
          "Is this a complete water outage or low pressure?",
          "When did you first notice the issue?",
          "Are your neighbours experiencing the same problem?",
          "What's your exact address?"
        ],
        tip: "Remember to keep some emergency water stored. It's recommended to have 3-5 litres per person per day."
      },
      electricity: {
        questions: [
          "Is this a complete power outage?",
          "When did the power go out?",
          "Is this affecting your whole street/area?",
          "Have you checked the Eskom schedule for planned outages?"
        ],
        tip: "Keep emergency lights charged and ready. Consider investing in a surge protector for when power returns."
      }
    };
    
    let currentIssue = null;
    let gatheredInfo = {};
    let questionIndex = 0;
    
    //openChat
    /////////////////////////////////////////////////////////////////////
    
    function openChat() {
      const existingChat = document.querySelector('.chat-window');
      if (existingChat) {
        existingChat.remove();
        document.querySelector('.modal-backdrop').remove();
        return;
      }
    
      const backdrop = document.createElement('div');
      backdrop.className = 'modal-backdrop';
      backdrop.onclick = (e) => {
        if (e.target === backdrop) {
          backdrop.remove();
          document.querySelector('.chat-window').remove();
        }
      };
      document.body.appendChild(backdrop);
    
      const chatWindow = document.createElement('div');
      chatWindow.className = 'chat-window';
      chatWindow.style.cssText = `
        position: fixed;
        bottom: 90px;
        right: 20px;
        width: 350px;
        height: 400px;  
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        display: flex;
        flex-direction: column;
        z-index: 1000;
      `;
      chatWindow.innerHTML = `
        <div style="padding: 0.75rem; background: var(--primary); color: white; border-radius: 12px 12px 0 0;">
          Municipal Help Chat
          <button onclick="this.parentElement.parentElement.remove(); document.querySelector('.modal-backdrop').remove()" 
                  style="float: right; background: none; border: none; color: white; cursor: pointer;">×</button>
        </div>
        <div id="chatMessages" style="flex: 1; overflow-y: auto; padding: 0.75rem;"></div>
        <div style="padding: 0.75rem; border-top: 1px solid #eee;">
          <input type="text" id="chatInput" placeholder="Type your message..." 
                 style="width: 80%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;">
          <button onclick="sendMessage()" 
                  style="width: 18%; padding: 0.5rem; background: var(--primary); color: white; border: none; border-radius: 4px;">
            Send
          </button>
        </div>
      `;
      document.body.appendChild(chatWindow);
      
      addMessage("Bot", "Welcome! How can I help you today?");
    }
    
    //sendMessage
    /////////////////////////////////////////////////////////////////////
    
    function sendMessage() {
      try {
        const input = document.getElementById('chatInput');
        const message = input.value.trim();
        
        if (!message) {
          showTip('Please enter a message', 'chatInput');
          return;
        }
        
        if (message.length > 500) {
          showError('Message too long (maximum 500 characters)', 'chatInput');
          return;
        }
        
        addMessage("You", message);
        processMessage(message);
        input.value = '';
        
      } catch (error) {
        console.error('Error sending message:', error);
        showError('Failed to send message. Please try again.', 'chatInput');
      }
    }
    
    //addMessage
    /////////////////////////////////////////////////////////////////////
    
    function addMessage(sender, text) {
      const messages = document.getElementById('chatMessages');
      const messageDiv = document.createElement('div');
      messageDiv.style.marginBottom = '10px';
      messageDiv.innerHTML = `<strong>${sender}:</strong> ${text}`;
      messages.appendChild(messageDiv);
      messages.scrollTop = messages.scrollHeight;
      chatHistory.push({sender, text});
    }
    
    //processMessage
    /////////////////////////////////////////////////////////////////////
    
    function processMessage(message) {
      const lowerMessage = message.toLowerCase();
      
      if (currentIssue) {
        gatheredInfo[`answer${questionIndex}`] = message;
        questionIndex++;
        
        if (questionIndex >= keywords[currentIssue].questions.length) {
          const tip = keywords[currentIssue].tip;
          setTimeout(() => {
            addMessage("Bot", "Thank you for providing all that information. I've created a service request for you.");
            addMessage("Bot", "Helpful tip: " + tip);
            
            createServiceRequest(currentIssue, gatheredInfo);
            
            currentIssue = null;
            gatheredInfo = {};
            questionIndex = 0;
          }, 500);
          return;
        }
        
        setTimeout(() => {
          addMessage("Bot", keywords[currentIssue].questions[questionIndex]);
        }, 500);
        return;
      }
      
      for (const [issue, data] of Object.entries(keywords)) {
        if (lowerMessage.includes(issue)) {
          currentIssue = issue;
          questionIndex = 0;
          gatheredInfo = {};
          
          setTimeout(() => {
            addMessage("Bot", "I can help you report this " + issue + " issue.");
            addMessage("Bot", data.questions[0]);
          }, 500);
          return;
        }
      }
      
      setTimeout(() => {
        addMessage("Bot", "I'm here to help report issues or request services. Could you tell me what type of issue you're experiencing? (For example: pothole, water, or electricity issues)");
      }, 500);
    }
    
    //showConfirmationPopup
    /////////////////////////////////////////////////////////////////////
    
    function showConfirmationPopup(requestId) {
      const backdrop = document.createElement('div');
      backdrop.className = 'modal-backdrop';
      document.body.appendChild(backdrop);
    
      const popup = document.createElement('div');
      popup.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 1002;
        text-align: center;
        min-width: 300px;
      `;
    
      popup.innerHTML = `
        <h2 style="color: var(--primary); margin-bottom: 1rem;">Request Submitted!</h2>
        <p style="margin-bottom: 1.5rem;">Your request number is:</p>
        <div style="
          font-size: 2rem;
          font-weight: bold;
          color: var(--primary);
          padding: 1rem;
          background: var(--info-bg);
          border-radius: 8px;
          margin-bottom: 1.5rem;
        ">#${requestId}</div>
        <p style="margin-bottom: 1.5rem;">Please keep this number for your records.</p>
        <button class="btn" onclick="this.parentElement.remove(); document.querySelector('.modal-backdrop').remove();">
          Close
        </button>
      `;
    
      document.body.appendChild(popup);
    }
    
    //////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    
    /* SERVICE REQUEST */
    
    //////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    
    //submitRequest
    /////////////////////////////////////////////////////////////////////
    
    function submitRequest() {
      try {
        const requestTypeEl = document.getElementById('requestType');
        const categoryEl = document.getElementById('category');
        const locationEl = document.getElementById('location');
        const descriptionEl = document.getElementById('description');
    
        if (!requestTypeEl || !categoryEl || !locationEl || !descriptionEl) {
          console.error('Required form elements not found');
          showError('Required form elements not found', 'requestType');
          return;
        }
    
        const type = requestTypeEl.value;
        const category = categoryEl.value;
        const location = locationEl.value.trim();
        const description = descriptionEl.value.trim();
    
        document.querySelectorAll('.error-message, .tip-message').forEach(e => e.remove());
        
        if (!type) {
          showError('Please select a request type', 'requestType');
          return;
        }
        
        if (!category) {
          showError('Please select a category', 'category');
          return;
        }
        
        if (!location || location.length < 5) {
          showError('Please enter a valid location (minimum 5 characters)', 'location');
          return;
        }
        
        if (!description || description.length < 20) {
          showError('Please provide a detailed description (minimum 20 characters)', 'description');
          return;
        }
        
        const mediaInput = document.getElementById('media');
        let mediaFiles = [];
        if (mediaInput && mediaInput.files.length > 0) {
          const maxSize = 5 * 1024 * 1024;
          for (let file of mediaInput.files) {
            if (file.size > maxSize) {
              showError('Files must be less than 5MB', 'media');
              return;
            }
            mediaFiles.push({
              name: file.name,
              size: file.size,
              type: file.type
            });
          }
        }
        
        const requestId = serviceRequests.length > 0 
          ? Math.max(...serviceRequests.map(r => r.id)) + 1 
          : 1001;
        
        const newRequest = {
          id: requestId,
          type: category,
          requestType: type,
          status: 'Pending',
          date: new Date().toISOString().split('T')[0],
          description,
          location,
          media: mediaFiles,
          updates: []
        };
        
        serviceRequests.push(newRequest);
        
        document.querySelector('.report-form').remove();
        document.querySelector('.modal-backdrop').remove();
        
        showConfirmationPopup(requestId);
        
      } catch (error) {
        console.error('Error submitting request:', error);
        showError('An error occurred while submitting your request. Please try again.', 'requestType');
      }
    }
    
    //createServiceRequest
    /////////////////////////////////////////////////////////////////////
    
    function createServiceRequest(type, info) {
      const requestId = serviceRequests.length > 0 
        ? Math.max(...serviceRequests.map(r => r.id)) + 1 
        : 1001;
        
      const newRequest = {
        id: requestId,
        type: type.charAt(0).toUpperCase() + type.slice(1),
        status: 'Pending',
        date: new Date().toISOString().split('T')[0],
        description: Object.values(info).join(' | '),
        location: info.answer0, 
        media: [], 
        updates: [] 
      };
      
      serviceRequests.push(newRequest);
      
      setTimeout(() => {
        addMessage("Bot", `I've created service request #${requestId} for you. You can track its status in the Service Request Tracker.`);
      }, 500);
    }
    
    /////////////////////////////////////////////////////////////////////
    
    /* SERVICE REQUEST NODE */
    
    /////////////////////////////////////////////////////////////////////
    
    class ServiceRequestNode {
      constructor(request) {
        this.request = request;
        this.left = null;
        this.right = null;
      }
    }
    
    /////////////////////////////////////////////////////////////////////
    
    /* SERVICE REQUEST TREE */
    
    /////////////////////////////////////////////////////////////////////
    
    class ServiceRequestTree {
      constructor() {
        this.root = null;
      }
      
      insert(request) {
        const node = new ServiceRequestNode(request);
        
        if (!this.root) {
          this.root = node;
          return;
        }
        
        this.insertNode(this.root, node);
      }
      
      insertNode(root, node) {
        if (node.request.id < root.request.id) {
          if (root.left === null) {
            root.left = node;
          } else {
            this.insertNode(root.left, node);
          }
        } else {
          if (root.right === null) {
            root.right = node;
          } else {
            this.insertNode(root.right, node);
          }
        }
      }
      
      inOrderTraversal(node = this.root, result = []) {
        if (node !== null) {
          this.inOrderTraversal(node.left, result);
          result.push(node.request);
          this.inOrderTraversal(node.right, result);
        }
        return result;
      }
      
      find(id, node = this.root) {
        if (node === null) {
          return null;
        }
        
        if (node.request.id === id) {
          return node.request;
        }
        
        if (id < node.request.id) {
          return this.find(id, node.left);
        } else {
          return this.find(id, node.right);
        }
      }
    }
    
    /////////////////////////////////////////////////////////////////////
    
    /* IssueGraph */
    
    /////////////////////////////////////////////////////////////////////
    
    class IssueGraph {
      constructor() {
        this.vertices = new Map();
        this.edges = new Map();
      }
      
      addVertex(request) {
        if (!this.vertices.has(request.id)) {
          this.vertices.set(request.id, request);
          this.edges.set(request.id, new Set());
        }
      }
      
      addEdge(request1Id, request2Id) {
        if (this.vertices.has(request1Id) && this.vertices.has(request2Id)) {
          this.edges.get(request1Id).add(request2Id);
          this.edges.get(request2Id).add(request1Id);
        }
      }
      
      getRelatedRequests(requestId) {
        return Array.from(this.edges.get(requestId) || [])
          .map(id => this.vertices.get(id))
          .filter(Boolean);
      }
      
      getAllRequests() {
        return Array.from(this.vertices.values());
      }
    }
    
    const serviceRequestTree = new ServiceRequestTree();
    const issueGraph = new IssueGraph();
    
    let serviceRequests = [];
    
    [
      {
        id: 1001,
        type: 'Pothole Repair',
        status: 'In Progress',
        date: '2024-01-15',
        location: 'Mandela Drive, Pretoria',
        description: 'Tree causing a hazard in the right lane.',
        media: [ { url: "https://www.google.com/url?sa=i&url=https%3A%2F%2Fwww.istockphoto.com%2Fphotos%2Ffallen-tree-road&psig=AOvVaw3uzZRautrwRS8CouspWWsC&ust=1732027306535000&source=images&cd=vfe&opi=89978449&ved=0CBEQjRxqFwoTCKjW7tWO5okDFQAAAAAdAAAAABAE", description: "Tree blocking the road" }
        ],
        updates: [
          { date: '2024-09-16', message: 'Request received and work is scheduled.' }
        ]
      },
      {
        id: 1002,
        type: 'Street Light Maintenance',
        status: 'Pending',
        date: '2024-10-16',
        location: 'Long Street, Cape Town',
        description: 'Street light is flickering.',
        media: [],
        updates: []
      },
      {
        id: 1003,
        type: 'Water Supply Issue',
        status: 'Completed',
        date: '2024-02-17',
        location: 'Soweto, Johannesburg',
        description: 'Pressure issue during peak hours.',
        media: [],
        updates: [
          { date: '2024-04-18', message: 'Issue resolved and normal pressure restored.' }
        ]
      },
      {
        id: 1004,
        type: "Illegal Dumping",
        status: "In Progress",
        date: "2024-07-20",
        location: "Main Street, Durban",
        description: "Large pile of waste dumped on the sidewalk.",
        media: [],
        updates: [
          { date: "2024-08-21", message: "Inspection team dispatched to assess the situation." }
        ]
      },
      {
        id: 1005,
        type: "Broken Traffic Light",
        status: "Pending",
        date: "2024-05-22",
        location: "Sandton Drive, Johannesburg",
        description: "Traffic light not functioning at a busy intersection.",
        media: [],
        updates: []
      },
      {
        id: 1006,
        type: "Blocked Drain",
        status: "In Progress",
        date: "2024-05-10",
        location: "Church Street, Polokwane",
        description: "Stormwater drain blocked causing water pooling.",
        media: [],
        updates: [
          { date: "2024-06-24", message: "Drain clearing crew assigned to the task." }
        ]
      },
      {
        id: 1007,
        type: "Road Marking",
        status: "Completed",
        date: "2024-01-24",
        location: "Voortrekker Road, Cape Town",
        description: "Faded pedestrian crossing lines need repainting.",
        media: [],
        updates: [
          { date: "2024-03-25", message: "Road markings repainted successfully." }
        ]
      },
      {
        id: 1008,
        type: "Overgrown Vegetation",
        status: "Pending",
        date: "2024-03-25",
        location: "Oxford Road, East London",
        description: "Bushes and trees obstructing the sidewalk.",
        media: [],
        updates: []
      },
      {
        id: 1009,
        type: "Power Outage",
        status: "In Progress",
        date: "2024-02-26",
        location: "Central Park, Bloemfontein",
        description: "Extended power outage reported in the area.",
        media: [],
        updates: [
          { date: "2024-07-27", message: "Technicians working to restore power." }
        ]
      },
      {
        id: 1010,
        type: "Leaking Pipe",
        status: "Completed",
        date: "2024-01-27",
        location: "Nelson Mandela Avenue, Port Elizabeth",
        description: "Water leak near the main junction.",
        media: [],
        updates: [
          { date: "2024-07-28", message: "Leak repaired and water supply restored." }
        ]
      },
      {
        id: 1011,
        type: "Tree Removal",
        status: "Pending",
        date: "2024-04-28",
        location: "Zulu Street, Pietermaritzburg",
        description: "Fallen tree blocking the road.",
        media: [],
        updates: []
      },
      {
        id: 1012,
        type: "Animal Control",
        status: "In Progress",
        date: "2024-03-29",
        location: "Market Square, Pretoria",
        description: "Stray dog causing a disturbance.",
        media: [],
        updates: [
          { date: "2024-05-30", message: "Animal control team deployed to handle the situation." }
        ]
      },
      {
        id: 1013,
        type: "Public Toilet Maintenance",
        status: "Completed",
        date: "2024-06-30",
        location: "Waterfront, Cape Town",
        description: "Broken fixtures and unhygienic conditions reported.",
        media: [],
        updates: [
          { date: "2024-07-31", message: "Repairs completed and facilities cleaned." }
        ]
      }
    ].forEach(request => {
      serviceRequestTree.insert(request);
      issueGraph.addVertex(request);
      serviceRequests.push(request);
    });
    
    issueGraph.addEdge(1001, 1002); 
    
    // submitRequest
    /////////////////////////////////////////////////////////////////////
    
    function submitRequest() {
      try {
        const requestTypeEl = document.getElementById('requestType');
        const categoryEl = document.getElementById('category');
        const locationEl = document.getElementById('location');
        const descriptionEl = document.getElementById('description');
    
        if (!requestTypeEl || !categoryEl || !locationEl || !descriptionEl) {
          console.error('Required form elements not found');
          return;
        }
    
        const type = requestTypeEl.value;
        const category = categoryEl.value;
        const location = locationEl.value.trim();
        const description = descriptionEl.value.trim();
    
        document.querySelectorAll('.error-message, .tip-message').forEach(e => e.remove());
        
        if (!type) {
          showError('Please select a request type', 'requestType');
          return;
        }
        
        if (!category) {
          showError('Please select a category', 'category');
          return;
        }
        
        if (!location || location.length < 5) {
          showError('Please enter a valid location (minimum 5 characters)', 'location');
          return;
        }
        
        if (!description || description.length < 20) {
          showError('Please provide a detailed description (minimum 20 characters)', 'description');
          return;
        }
    
        const requestId = serviceRequests.length > 0 
          ? Math.max(...serviceRequests.map(r => r.id)) + 1 
          : 1001;
        
        const newRequest = {
          id: requestId,
          type: category,
          requestType: type,
          status: 'Pending',
          date: new Date().toISOString().split('T')[0],
          description,
          location,
          media: [], 
          updates: [] 
        };
        
        // Add to service request tree and graph
        serviceRequestTree.insert(newRequest);
        issueGraph.addVertex(newRequest);
        serviceRequests.push(newRequest);
        
        showTip(`Request #${requestId} submitted successfully!`, 'requestType');
        
        setTimeout(() => {
          const formEl = document.querySelector('.report-form');
          const backdropEl = document.querySelector('.modal-backdrop');
          if (formEl) formEl.remove();
          if (backdropEl) backdropEl.remove();
        }, 2000);
        
      } catch (error) {
        console.error('Error submitting request:', error);
      }
    }
    
    //showError
    /////////////////////////////////////////////////////////////////////
    
    function showError(message, elementId) {
      const element = document.getElementById(elementId);
      if (!element) return;
      
      const existingError = element.parentElement.querySelector('.error-message');
      if (existingError) existingError.remove();
      
      const errorDiv = document.createElement('div');
      errorDiv.className = 'error-message';
      errorDiv.textContent = message;
      element.parentElement.appendChild(errorDiv);
    }
    
    //showTip
    /////////////////////////////////////////////////////////////////////
    
    function showTip(message, elementId) {
      const element = document.getElementById(elementId);
      if (!element) return;
      
      const existingTip = element.parentElement.querySelector('.tip-message');
      if (existingTip) existingTip.remove();
      
      const tipDiv = document.createElement('div');
      tipDiv.className = 'tip-message';
      tipDiv.textContent = message;
      element.parentElement.appendChild(tipDiv);
    }
    
    //////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    
    /* REQUEST TRACKER */
    
    //////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    
    //showTracker
    /////////////////////////////////////////////////////////////////////
    
    function showTracker() {
      const backdrop = document.createElement('div');
      backdrop.className = 'modal-backdrop';
      document.body.appendChild(backdrop);
    
      const tracker = document.createElement('div');
      tracker.className = 'tracker-window';
      tracker.innerHTML = `
        <div style="
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          width: 90%;
          max-width: 800px;
          height: 90vh;
          background: white;
          border-radius: 12px;
          box-shadow: 0 4px 12px rgba(0,0,0,0.15);
          z-index: 1000;
          display: flex;
          flex-direction: column;
          overflow: hidden;
        ">
          <div style="padding: 1rem; background: var(--primary); color: white; border-radius: 12px 12px 0 0;">
            Service Request Tracker
            <button onclick="this.parentElement.parentElement.remove(); document.querySelector('.modal-backdrop').remove()" 
                    style="float: right; background: none; border: none; color: white; cursor: pointer;">×</button>
          </div>
          <div style="padding: 1rem; height: calc(90vh - 60px); overflow-y: auto;">
            <input type="text" placeholder="Search requests..." 
                   onkeyup="filterRequests(this.value)"
                   style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 1rem;">
            <div id="requestList" style="overflow-y: auto;"></div>
          </div>
        </div>
      `;
      document.body.appendChild(tracker);
      displayRequests();
    }
    
    //displayFunction
    /////////////////////////////////////////////////////////////////////
    
    function displayRequests() {
      const requestList = document.getElementById('requestList');
      if (!requestList) return;
      
      if (serviceRequests.length === 0) {
        requestList.innerHTML = '<p>No service requests found.</p>';
        return;
      }
      
      requestList.innerHTML = serviceRequests.map(request => `
        <div 
          onclick="showRequestDetails(${request.id})"
          style="
            padding: 1rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 0.5rem;
            background: ${getStatusColor(request.status)};
            cursor: pointer;
            transition: transform 0.2s ease;
          "
          onmouseover="this.style.transform='scale(1.01)'"
          onmouseout="this.style.transform='scale(1)'"
        >
          <strong>Request #${request.id}</strong><br>
          Type: ${request.type}<br>
          Status: ${request.status}<br>
          Date: ${request.date}
        </div>
      `).join('');
    }
    
    //showRequestDetails
    /////////////////////////////////////////////////////////////////////
    
    function showRequestDetails(requestId) {
      const request = serviceRequestTree.find(requestId);
      if (!request) {
        console.error('Request not found:', requestId);
        return;
      }
    
      const existingModal = document.querySelector('.request-details-modal');
      const existingBackdrop = document.querySelector('.modal-backdrop');
      if (existingModal) existingModal.remove();
      if (existingBackdrop) existingBackdrop.remove();
    
      const backdrop = document.createElement('div');
      backdrop.className = 'modal-backdrop';
      backdrop.style.backdropFilter = 'blur(4px)';
      backdrop.style.zIndex = '1000';
      document.body.appendChild(backdrop);
    
      const detailsModal = document.createElement('div');
      detailsModal.className = 'request-details-modal';
      detailsModal.innerHTML = `
        <div style="
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          width: 90%;
          max-width: 600px;
          background: white;
          border-radius: 12px;
          box-shadow: 0 4px 12px rgba(0,0,0,0.15);
          z-index: 1001;
          padding: 0;
          overflow: hidden;
        ">
          <div style="padding: 1rem; background: var(--primary); color: white; display: flex; justify-content: space-between; align-items: center;">
            <h2 style="margin: 0;">Request #${request.id} Details</h2>
            <button 
              onclick="this.closest('.request-details-modal').remove(); document.querySelector('.modal-backdrop').remove();"
              style="background: none; border: none; color: white; cursor: pointer; font-size: 1.5rem;"
            >×</button>
          </div>
          
          <div style="padding: 1.5rem;">
            <div style="margin-bottom: 1rem;">
              <strong>Type:</strong> ${request.type}
            </div>
            <div style="margin-bottom: 1rem;">
              <strong>Status:</strong> 
              <span style="
                display: inline-block;
                padding: 0.25rem 0.5rem;
                border-radius: 4px;
                background: ${getStatusColor(request.status)};
              ">${request.status}</span>
            </div>
            <div style="margin-bottom: 1rem;">
              <strong>Date Submitted:</strong> ${request.date}
            </div>
            <div style="margin-bottom: 1rem;">
              <strong>Location:</strong> ${request.location}
            </div>
            <div style="margin-bottom: 1rem;">
              <strong>Description:</strong>
              <p style="margin-top: 0.5rem;">${request.description || 'No description provided'}</p>
            </div>
            
            ${request.media && request.media.length ? `
              <div style="margin-top: 1.5rem;">
                <strong>Attached Media:</strong>
                <div style="
                  margin-top: 0.5rem;
                  display: grid;
                  grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                  gap: 1rem;
                ">
                  ${request.media.map(m => `
                    <div style="
                      aspect-ratio: 1;
                      background: #f5f5f5;
                      border-radius: 8px;
                      overflow: hidden;
                    ">
                      <img 
                        src="${m.url}" 
                        alt="${m.description || 'Attached media'}"
                        style="width: 100%; height: 100%; object-fit: cover;"
                      >
                    </div>
                  `).join('')}
                </div>
              </div>
            ` : ''}
            
            <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid #eee;">
              <h3 style="margin-bottom: 1rem; color: var(--primary);">Status Updates</h3>
              ${request.updates && request.updates.length ? `
                <div style="max-height: 200px; overflow-y: auto;">
                  ${request.updates.map(update => `
                    <div style="margin-bottom: 0.75rem; padding-left: 1rem; border-left: 3px solid var(--primary);">
                      <div style="font-size: 0.9rem; color: var(--grey-dark);">${update.date}</div>
                      <div>${update.message}</div>
                    </div>
                  `).join('')}
                </div>
              ` : '<p>No status updates available</p>'}
            </div>
          </div>
        </div>
      `;
      
      document.body.appendChild(detailsModal);
    
      backdrop.onclick = (e) => {
        if (e.target === backdrop) {
          detailsModal.remove();
          backdrop.remove();
        }
      };
    }
    
    
    //getStatusColor
    /////////////////////////////////////////////////////////////////////
    
    function getStatusColor(status) {
      const colors = {
        'Pending': '#fff3e0',
        'In Progress': '#e3f2fd',
        'Completed': '#e8f5e9'
      };
      return colors[status] || 'white';
    }
    
    //filterRequests
    /////////////////////////////////////////////////////////////////////
    
    function filterRequests(query) {
      const filteredRequests = serviceRequests.filter(request => {
        return !query || 
          request.type.toLowerCase().includes(query.toLowerCase()) ||
          request.location.toLowerCase().includes(query.toLowerCase()) ||
          request.id.toString().includes(query);
      });
    
      const requestList = document.getElementById('requestList');
      if (!requestList) return;
    
      requestList.innerHTML = filteredRequests.length ? 
        filteredRequests.map(request => `
          <div 
            onclick="showRequestDetails(${request.id})"
            style="
              padding: 1rem;
              border: 1px solid #ddd;
              border-radius: 4px;
              margin-bottom: 0.5rem;
              background: ${getStatusColor(request.status)};
              cursor: pointer;
              transition: transform 0.2s ease;
            "
            onmouseover="this.style.transform='scale(1.01)'"
            onmouseout="this.style.transform='scale(1)'"
          >
            <strong>Request #${request.id}</strong><br>
            Type: ${request.type}<br>
            Status: ${request.status}<br>
            Date: ${request.date}
          </div>
        `).join('') :
        '<p>No matching requests found.</p>';
    }
    
    //showReportForm
    /////////////////////////////////////////////////////////////////////
    
    function showReportForm() {
      const backdrop = document.createElement('div');
      backdrop.className = 'modal-backdrop';
      document.body.appendChild(backdrop);
    
      const formWindow = document.createElement('div');
      formWindow.className = 'report-form';
      formWindow.innerHTML = `
        <div style="
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          width: 90%;
          max-width: 800px;
          height: 90vh;
          background: white;
          border-radius: 12px;
          box-shadow: 0 4px 12px rgba(0,0,0,0.15);
          z-index: 1000;
          display: flex;
          flex-direction: column;
          overflow: hidden;
        ">
          <div style="padding: 1rem; background: var(--primary); color: white; border-radius: 12px 12px 0 0;">
            Report Issue / Request Service
            <button onclick="this.parentElement.parentElement.remove(); document.querySelector('.modal-backdrop').remove()" 
                    style="float: right; background: none; border: none; color: white; cursor: pointer;">×</button>
          </div>
    
          <div style="padding: 1rem; background: var(--grey-light); border-bottom: 1px solid var(--grey);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
              <span>Form Progress</span>
              <span id="progressPercent">0%</span>
            </div>
            <div style="width: 100%; height: 8px; background: var(--grey); border-radius: 4px; overflow: hidden;">
              <div id="progressBar" style="width: 0%; height: 100%; background: var(--primary); transition: width 0.3s ease;"></div>
            </div>
          </div>
    
          <div style="padding: 1.5rem; overflow-y: auto;">
            <div class="form-group">
              <label for="requestType">Request Type</label>
              <select id="requestType" class="form-control">
                <option value="">Select type...</option>
                <option value="report">Report Issue</option>
                <option value="service">Request Service</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="category">Category</label>
              <select id="category" class="form-control">
    <option value="">Select category...</option>
    <option value="roads">Roads & Potholes</option>
    <option value="utilities">Water & Electricity</option>
    <option value="waste">Refuse Collection</option>
    <option value="parks">Parks & Recreation</option>
    <option value="safety">Community Safety</option>
    <option value="transport">Public Transport</option>
    <option value="housing">Housing Services</option>
    <option value="sanitation">Sanitation</option>
    <option value="noise">Noise Complaints</option>
    <option value="permits">Building Permits</option>
    <option value="lights">Street Light Maintenance</option>
    <option value="drainage">Blocked Drains</option>
    <option value="vegetation">Overgrown Vegetation</option>
    <option value="power">Power Outages</option>
    <option value="markings">Road Markings</option>
    <option value="leaks">Leaking Pipes</option>
    <option value="tree-removal">Tree Removal</option>
    <option value="animal-control">Animal Control</option>
    <option value="toilets">Public Toilet Maintenance</option>
    <option value="dumping">Illegal Dumping</option>
    <option value="traffic">Traffic Light Issues</option>
    
              </select>
            </div>
            
            <div class="form-group">
              <label for="location">Location</label>
              <input type="text" id="location" class="form-control" placeholder="Enter address or location">
            </div>
            
            <div class="form-group">
              <label for="description">Description</label>
              <textarea id="description" class="form-control" rows="4" placeholder="Please describe the issue or service request"></textarea>
            </div>
            
            <div id="mediaUpload" class="form-group" style="display: none;">
              <label for="media">Upload Photos/Videos</label>
              <input type="file" id="media" class="form-control" accept="image/*,video/*" multiple>
            </div>
            
            <button class="btn" onclick="submitRequest()" style="width: 100%;">Submit Request</button>
          </div>
        </div>
      `;
      document.body.appendChild(formWindow);
      
      initializeFormElements();
    }
    
    //initializedFormElements
    /////////////////////////////////////////////////////////////////////
    
    function initializeFormElements() {
      const requestTypeSelect = document.getElementById('requestType');
      const mediaUpload = document.getElementById('mediaUpload');
      const categorySelect = document.getElementById('category');
      const locationInput = document.getElementById('location');
      const descriptionInput = document.getElementById('description');
      const submitButton = document.querySelector('.report-form .btn');
      
      if (requestTypeSelect) {
        requestTypeSelect.addEventListener('change', (e) => {
          if (mediaUpload) {
            mediaUpload.style.display = e.target.value === 'report' ? 'block' : 'none';
          }
          updateProgress();
        });
      }
    
      if (categorySelect) {
        categorySelect.addEventListener('change', updateProgress);
      }
    
      if (locationInput) {
        locationInput.addEventListener('input', updateProgress);
      }
    
      if (descriptionInput) {
        descriptionInput.addEventListener('input', updateProgress);
      }
    
      if (submitButton) {
        submitButton.disabled = true;
        submitButton.style.opacity = '0.5';
        submitButton.style.cursor = 'not-allowed';
      }
      
      updateProgress();
    }
    
    //updateProgress
    /////////////////////////////////////////////////////////////////////
    
    function updateProgress() {
      const requestType = document.getElementById('requestType');
      const category = document.getElementById('category');
      const location = document.getElementById('location');
      const description = document.getElementById('description');
      const submitButton = document.querySelector('.report-form .btn');
      const progressBar = document.getElementById('progressBar');
      const progressText = document.getElementById('progressPercent');
    
      if (!requestType || !category || !location || !description) {
        console.warn('Form elements not found');
        return;
      }
    
      const fields = {
        requestType: requestType.value,
        category: category.value,
        location: location.value.trim(),
        description: description.value.trim()
      };
      
      const weights = {
        requestType: 0.25,
        category: 0.25,
        location: 0.25,
        description: 0.25
      };
      
      let progress = 0;
      
      for (const [field, value] of Object.entries(fields)) {
        if (value && (field !== 'description' || value.length >= 20)) {
          progress += weights[field];
        }
      }
      
      const progressPercent = Math.round(progress * 100);
      
      if (progressBar) progressBar.style.width = `${progressPercent}%`;
      if (progressText) progressText.textContent = `${progressPercent}%`;
      
      if (submitButton) {
        const isComplete = progressPercent === 100;
        submitButton.disabled = !isComplete;
        submitButton.style.opacity = isComplete ? '1' : '0.5';
        submitButton.style.cursor = isComplete ? 'pointer' : 'not-allowed';
      }
    }
    
    //submitRequest
    /////////////////////////////////////////////////////////////////////
    
    function submitRequest() {
      try {
        const requestTypeEl = document.getElementById('requestType');
        const categoryEl = document.getElementById('category');
        const locationEl = document.getElementById('location');
        const descriptionEl = document.getElementById('description');
    
        if (!requestTypeEl || !categoryEl || !locationEl || !descriptionEl) {
          console.error('Required form elements not found');
          showError('Required form elements not found', 'requestType');
          return;
        }
    
        const type = requestTypeEl.value;
        const category = categoryEl.value;
        const location = locationEl.value.trim();
        const description = descriptionEl.value.trim();
    
        document.querySelectorAll('.error-message, .tip-message').forEach(e => e.remove());
        
        if (!type) {
          showError('Please select a request type', 'requestType');
          return;
        }
        
        if (!category) {
          showError('Please select a category', 'category');
          return;
        }
        
        if (!location || location.length < 5) {
          showError('Please enter a valid location (minimum 5 characters)', 'location');
          return;
        }
        
        if (!description || description.length < 10) {
          showError('Please provide a detailed description (minimum 20 characters)', 'description');
          return;
        }
        
        const mediaInput = document.getElementById('media');
        let mediaFiles = [];
        if (mediaInput && mediaInput.files.length > 0) {
          const maxSize = 5 * 1024 * 1024; // 5MB
          for (let file of mediaInput.files) {
            if (file.size > maxSize) {
              showError('Files must be less than 5MB', 'media');
              return;
            }
            mediaFiles.push({
              name: file.name,
              size: file.size,
              type: file.type
            });
          }
        }
        
        const requestId = serviceRequests.length > 0 
          ? Math.max(...serviceRequests.map(r => r.id)) + 1 
          : 1001;
        
        const newRequest = {
          id: requestId,
          type: category,
          requestType: type,
          status: 'Pending',
          date: new Date().toISOString().split('T')[0],
          description,
          location,
          media: mediaFiles,
          updates: [] 
        };
        
        serviceRequests.push(newRequest);
        
        showConfirmationPopup(requestId);
        
        setTimeout(() => {
          const formEl = document.querySelector('.report-form');
          const backdropEl = document.querySelector('.modal-backdrop');
          if (formEl) formEl.remove();
          if (backdropEl) backdropEl.remove();
        }, 2000);
        
      } catch (error) {
        console.error('Error submitting request:', error);
        showError('An error occurred while submitting your request. Please try again.', 'requestType');
      }
    }
    
    //hideSplashScreen
    /////////////////////////////////////////////////////////////////////
    
    function hideSplashScreen() {
      const splashScreen = document.querySelector('.splash-screen');
      if (splashScreen) {
        splashScreen.classList.add('hidden');
      }
    }
    
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('.header-logo path').forEach(path => {
        path.style.animation = 'subtleFade 4s infinite';
      });
    
    //addRandomSparkle
    /////////////////////////////////////////////////////////////////////
    
      function addRandomSparkle() {
        const dashboard = document.querySelector('.dashboard');
        if (!dashboard) return;
        
        const sparkle = document.createElement('div');
        sparkle.style.cssText = `
          position: absolute;
          width: 4px;
          height: 4px;
          background: var(--accent);
          border-radius: 50%;
          pointer-events: none;
          opacity: 0;
          z-index: -1;
        `;
        
        const x = Math.random() * dashboard.offsetWidth;
        const y = Math.random() * dashboard.offsetHeight;
        sparkle.style.left = x + 'px';
        sparkle.style.top = y + 'px';
        
        dashboard.appendChild(sparkle);
        
        sparkle.animate([
          { opacity: 0, transform: 'scale(1)' },
          { opacity: 0.8, transform: 'scale(1.5)' },
          { opacity: 0, transform: 'scale(1)' }
        ], {
          duration: 2000,
          easing: 'ease-out'
        }).onfinish = () => sparkle.remove();
      }
    
      setInterval(addRandomSparkle, 3000);
    });
    
    //////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    
    /* EVENT SET */
    
    //////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    
    const eventSystem = {
      events: {},
      categories: new Set(),
      locations: new Set(),
      
      addEvent(event) {
        this.events[event.id] = event;
        this.categories.add(event.category);
        this.locations.add(event.location);
      }
    };
    
    //////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    
    /* NEWS QUEUE */
    
    //////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    
    class UpdateQueue {
      constructor() {
        this.items = [];
      }
      
      enqueue(update) {
        this.items.push(update);
      }
      
      dequeue() {
        return this.items.shift();
      }
      
      peek() {
        return this.items[0];
      }
      
      isEmpty() {
        return this.items.length === 0;
      }
    }
    
    const communityUpdates = new UpdateQueue();
    
    [
      {
        id: 'e1',
        title: 'Community Clean-up Day',
        category: 'Environment',
        location: 'Central Park, Johannesburg',
        date: '2024-02-01',
        description: 'Join us for our monthly community clean-up initiative to help keep our parks and streets clean.',
        type: 'event'
      },
      {
        id: 'e2',
        title: 'New Traffic Light Installation',
        category: 'Infrastructure',
        location: 'Main Street, Cape Town',
        date: '2024-01-25',
        description: 'Traffic light installation at the busy intersection of Main and Oak Streets to improve safety.',
        type: 'news'
      },
      {
        id: 'e3',
        title: 'Youth Empowerment Workshop',
        category: 'Community Development',
        location: 'Langa, Cape Town',
        date: '2024-02-10',
        description: 'A workshop focused on skills development and empowering the youth of Langa.',
        type: 'event'
      },
      {
        id: 'e4',
        title: 'Water Shortage in Gauteng',
        category: 'Utilities',
        location: 'Gauteng Province',
        date: '2024-01-30',
        description: 'A critical water shortage affecting several towns in Gauteng. Residents advised to reduce consumption.',
        type: 'news'
      },
      {
        id: 'e5',
        title: 'Mandela Day Fundraising',
        category: 'Charity',
        location: 'Sandton, Johannesburg',
        date: '2024-07-18',
        description: 'Join us for a fundraising event in honor of Mandela Day, supporting local communities.',
        type: 'event'
      },
      {
        id: 'e6',
        title: 'New Road Resurfacing Project',
        category: 'Infrastructure',
        location: 'Durban North',
        date: '2024-02-05',
        description: 'Resurfacing of the main road from Durban North to improve traffic flow and reduce accidents.',
        type: 'news'
      },
      {
        id: 'e7',
        title: 'Annual Job Expo',
        category: 'Employment',
        location: 'Pretoria, Tshwane',
        date: '2024-03-10',
        description: 'The annual job expo offering opportunities for job seekers across Pretoria.',
        type: 'event'
      },
      {
        id: 'e8',
        title: 'New School Construction',
        category: 'Education',
        location: 'Mamelodi, Pretoria',
        date: '2024-01-27',
        description: 'Construction of a new primary school to serve the growing community of Mamelodi.',
        type: 'news'
      },
      {
        id: 'e9',
        title: 'Heritage Day Celebrations',
        category: 'Culture',
        location: 'Union Buildings, Pretoria',
        date: '2024-09-24',
        description: 'Join the nation for Heritage Day celebrations, showcasing South Africa’s diverse cultures.',
        type: 'event'
      },
      {
        id: 'e10',
        title: 'Winter Blanket Drive',
        category: 'Charity',
        location: 'Cape Flats, Cape Town',
        date: '2024-06-15',
        description: 'Help those in need by donating blankets for the winter months in Cape Flats.',
        type: 'event'
      },
      {
        id: 'e11',
        title: 'New Public Park Opening',
        category: 'Recreation',
        location: 'Pretoria Central',
        date: '2024-02-12',
        description: 'A new public park is opening in Pretoria Central, providing space for recreation and relaxation.',
        type: 'event'
      },
      {
        id: 'e12',
        title: 'Community Health Fair',
        category: 'Health',
        location: 'Khayelitsha, Cape Town',
        date: '2024-03-05',
        description: 'Free health screenings and wellness advice at the annual community health fair in Khayelitsha.',
        type: 'event'
      },
      {
        id: 'e13',
        title: 'Electric Bus Launch',
        category: 'Transport',
        location: 'Cape Town City Centre',
        date: '2024-04-20',
        description: 'Cape Town launches the first electric bus route to promote sustainable urban transport.',
        type: 'news'
      },
      {
        id: 'e14',
        title: 'Business Networking Mixer',
        category: 'Business',
        location: 'Sandton, Johannesburg',
        date: '2024-02-18',
        description: 'A networking event for entrepreneurs and business leaders in Johannesburg.',
        type: 'event'
      },
      {
        id: 'e15',
        title: 'National Clean Water Campaign',
        category: 'Environment',
        location: 'Various Cities Nationwide',
        date: '2024-05-01',
        description: 'A nationwide campaign aiming to provide clean water solutions to underserved communities.',
        type: 'event'
      },
      {
        id: 'e16',
        title: 'National Strike for Workers’ Rights',
        category: 'Labour',
        location: 'Johannesburg CBD',
        date: '2024-02-20',
        description: 'Nationwide strike in support of workers’ rights and fair wages.',
        type: 'news'
      },
      {
        id: 'e17',
        title: 'South African Film Festival',
        category: 'Culture',
        location: 'Durban International Convention Centre',
        date: '2024-03-15',
        description: 'A celebration of local South African films, showcasing emerging talent in the film industry.',
        type: 'event'
      },
      {
        id: 'e18',
        title: 'New Renewable Energy Plant',
        category: 'Energy',
        location: 'Northern Cape',
        date: '2024-02-10',
        description: 'The opening of a new renewable energy plant to support sustainable power generation.',
        type: 'news'
      },
      {
        id: 'e19',
        title: 'Soweto Music Festival',
        category: 'Entertainment',
        location: 'Soweto, Johannesburg',
        date: '2024-04-30',
        description: 'Join the vibrant Soweto music festival for a weekend of live music and cultural performances.',
        type: 'event'
      },
      {
        id: 'e20',
        title: 'Road Safety Awareness Campaign',
        category: 'Safety',
        location: 'Durban CBD',
        date: '2024-05-10',
        description: 'A road safety awareness campaign aimed at reducing accidents and fatalities on the roads.',
        type: 'event'
      }
    ].forEach(event => eventSystem.addEvent(event));
    
    //showEvents
    /////////////////////////////////////////////////////////////////////
    
    function showEvents() {
      const backdrop = document.createElement('div');
      backdrop.className = 'modal-backdrop';
      document.body.appendChild(backdrop);
    
      const eventsWindow = document.createElement('div');
      eventsWindow.className = 'events-window';
      eventsWindow.innerHTML = `
        <div style="
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          width: 90%;
          max-width: 800px;
          height: 90vh;
          background: white;
          border-radius: 12px;
          box-shadow: 0 4px 12px rgba(0,0,0,0.15);
          z-index: 1000;
          display: flex;
          flex-direction: column;
          overflow: hidden;
        ">
          <div style="padding: 1rem; background: var(--primary); color: white; border-radius: 12px 12px 0 0;">
            Local Events & News
            <button onclick="this.parentElement.parentElement.remove(); document.querySelector('.modal-backdrop').remove()" 
                    style="float: right; background: none; border: none; color: white; cursor: pointer;">×</button>
          </div>
          
          <div style="padding: 1rem; background: var(--grey-light); border-bottom: 1px solid var(--grey);">
            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
              <select id="eventTypeFilter" class="form-control" style="flex: 1;">
                <option value="">All Types</option>
                <option value="event">Events</option>
                <option value="news">News</option>
              </select>
              
              <select id="categoryFilter" class="form-control" style="flex: 1;">
                <option value="">All Categories</option>
                ${Array.from(eventSystem.categories).map(cat => 
                  `<option value="${cat}">${cat}</option>`
                ).join('')}
              </select>
              
              <select id="locationFilter" class="form-control" style="flex: 1;">
                <option value="">All Locations</option>
                ${Array.from(eventSystem.locations).map(loc => 
                  `<option value="${loc}">${loc}</option>`
                ).join('')}
              </select>
            </div>
          </div>
    
          <div id="eventsList" style="padding: 1.5rem; overflow-y: auto;">
            ${generateEventsList()}
          </div>
        </div>
      `;
      
      document.body.appendChild(eventsWindow);
      
      ['eventTypeFilter', 'categoryFilter', 'locationFilter'].forEach(filterId => {
        document.getElementById(filterId)?.addEventListener('change', () => {
          document.getElementById('eventsList').innerHTML = generateEventsList();
        });
      });
    }
    
    //generateEventsList
    /////////////////////////////////////////////////////////////////////
    
    function generateEventsList() {
      const typeFilter = document.getElementById('eventTypeFilter')?.value || '';
      const categoryFilter = document.getElementById('categoryFilter')?.value || '';
      const locationFilter = document.getElementById('locationFilter')?.value || '';
      
      return Object.values(eventSystem.events)
        .filter(event => 
          (!typeFilter || event.type === typeFilter) &&
          (!categoryFilter || event.category === categoryFilter) &&
          (!locationFilter || event.location === locationFilter)
        )
        .map(event => generateEventHTML(event))
        .join('') || '<p>No events found matching your filters.</p>';
    }
    
    //generateEventHTML
    /////////////////////////////////////////////////////////////////////
    
    function generateEventHTML(event) {
      return `
        <div style="
          padding: 1rem;
          margin-bottom: 1rem;
          border-radius: 8px;
          background: ${event.type === 'event' ? 'var(--info-bg)' : 'var(--warning-bg)'};
          border-left: 4px solid ${event.type === 'event' ? 'var(--primary)' : 'var(--warning)'};
        ">
          <h3 style="margin-bottom: 0.5rem; color: var(--primary);">${event.title}</h3>
          <div style="margin-bottom: 0.5rem; font-size: 0.9rem; color: var(--grey-dark);">
            ${event.date} | ${event.location} | ${event.category}
          </div>
          <p>${event.description}</p>
        </div>
      `;
    }
    </script>
    </body>
    </html>